# AWS Lambda In-Depth – Part 2

## Lambda Networking Modes

Lambda functions support **two networking configurations**:

### 1. **Public Networking (Default)**

- Lambda runs **outside** your VPC in the **AWS public network**.
- Can access:
  - **AWS public services** (e.g., S3, DynamoDB, SQS)
  - **The Internet**
- **Cannot access**:
  - **Private VPC resources** (e.g., RDS, EC2, EFS) unless those are made public and accessible

> Offers best performance – no VPC provisioning overhead

---

### 2. **VPC Networking**

- Lambda runs **inside your VPC** in specified **private subnets**
- Treated like **any VPC-based resource**:
  - Can access other **VPC resources** (e.g., RDS, EC2, EFS)
  - Needs **IGW/NAT Gateway** or **VPC endpoints** to access:
    - AWS public services (e.g., DynamoDB)
    - The internet

> Must configure **security groups**, **route tables**, and **NAT gateway/VPC endpoints** accordingly.

---

### ENI (Elastic Network Interface) Architecture

#### Old Model (Pre-2021)

- One ENI **per function invocation** → high latency + scaling issues

#### New Model

- One ENI **per unique combo of subnet + security group**
- ENIs are **pre-provisioned** at configuration time (~90 sec setup)
- Reused across invocations → **reduced latency and improved scalability**

---

## Lambda Permissions

Lambda uses **two layers of IAM policies**:

### 1. **Execution Role (IAM Role)**

- Assigned to each Lambda function
- Lambda **assumes the role** at runtime
- Defines **what AWS resources** the function can access (e.g., S3, DynamoDB)
- Similar to **EC2 instance roles**
- **Must include permission to write to CloudWatch Logs** (e.g., `AWSLambdaBasicExecutionRole`)

### 2. **Resource Policy**

- Controls **who can invoke the Lambda function**
- Similar to **S3 bucket policy**
- Enables:
  - **Cross-account access**
  - Invocation by **AWS services** (e.g., SNS, S3)
- Managed via **CLI/API** (not console as of now)

---

## Monitoring & Logging

Lambda integrates with **CloudWatch** and **X-Ray** for observability:

| Service                | What It Captures                                             |
| ---------------------- | ------------------------------------------------------------ |
| **CloudWatch Logs**    | Logs generated by `console.log()` or similar in the function |
| **CloudWatch Metrics** | Invocations, errors, duration, throttles                     |
| **AWS X-Ray**          | **Distributed tracing** of user requests across services     |

> To log to **CloudWatch Logs**, the execution role must include `logs:*` permissions.

---
